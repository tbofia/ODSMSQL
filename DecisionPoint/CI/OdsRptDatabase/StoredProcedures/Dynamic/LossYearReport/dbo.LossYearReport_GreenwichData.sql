IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.LossYearReport_GreenwichData') AND type in (N'P', N'PC'))
DROP PROCEDURE dbo.LossYearReport_GreenwichData
GO

CREATE PROCEDURE dbo.LossYearReport_GreenwichData 
AS
BEGIN
INSERT INTO dbo.LossYearReport(
	ReportName,
	CustomerName,
	CompanyName,
	SOJ,
	AgeGroup,
	YOL,
	Year,
	Quarter,
	DateQuarter,
	FormType,
	CoverageType,
	CoverageTypeDesc,
	InjuryNatureId,
	InjuryNatureDesc,
	EncounterTypeId,
	EncounterTypeDesc,
	ServiceGroup,
	RevenueGroup,
	Gender,
	OutlierCat,
	ClaimantState,
	ClaimantCounty,
	ProviderSpecialty,
	ProviderState,
	Allowed,
	IndAllowed,
	Charged,
	IndCharged,
	UnitsCnt,
	IndUnitsCnt,
	ClaimantCnt,
	IndClaimantCnt,
	DOSCnt,
	IndDOSCnt,
	IsAllowedGreaterThanZero,
	RunDate
)
SELECT ReportName,
	'Greenwich' CustomerName,
	CompanyName,
	SOJ,
	AgeGroup,
	YOL,
	Year,
	Quarter,
	DateQuarter,
	FormType,
	CoverageType,
	CoverageTypeDesc,
	InjuryNatureId,
	InjuryNatureDesc,
	EncounterTypeId,
	EncounterTypeDesc,
	ServiceGroup,
	RevenueGroup,
	Gender,
	OutlierCat,
	ClaimantState,
	ClaimantCounty,
	ProviderSpecialty,
	ProviderState,
	SUM(Allowed*1.37),
	SUM(IndAllowed*1.46),
	SUM(Charged*1.54),
	SUM(IndCharged*1.64),
	SUM(UnitsCnt*2),
	SUM(IndUnitsCnt*3),
	SUM(ClaimantCnt*2),
	SUM(IndClaimantCnt*4),
	SUM(DOSCnt*2),
	SUM(IndDOSCnt*3),
	IsAllowedGreaterThanZero,
	GETDATE()
FROM [dbo].[LossYearReport]
WHERE CustomerName in ('Farmers Insurance Group','AAA Michigan','CSAA Insurance Group')
GROUP BY ReportName,
	CompanyName,
	SOJ,
	AgeGroup,
	YOL,
	Year,
	Quarter,
	DateQuarter,
	FormType,
	CoverageType,
	CoverageTypeDesc,
	InjuryNatureId,
	InjuryNatureDesc,
	EncounterTypeId,
	EncounterTypeDesc,
	ServiceGroup,
	RevenueGroup,
	Gender,
	OutlierCat,
	ClaimantState,
	ClaimantCounty,
	ProviderSpecialty,
	ProviderState,
	IsAllowedGreaterThanZero;
END
GO
